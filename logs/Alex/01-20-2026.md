### January 20th ‚Äì RTK Bring-Up, Verification, and Behavioral Testing

## Goal
Verify that the u-blox LR RTK Base/Rover kit is functioning end-to-end:
- Base broadcasting RTCM corrections
- Rover receiving corrections
- Achieving RTK FIX
- Understanding FIX/FLOAT behavior in real environments
- Identifying which data messages the ESP32 will eventually consume

---

## Base Station Setup
- Powered the **base station** via USB
- Connected:
  - GNSS antenna to ZED-F9P
  - LR antenna to XBee-SX radio
- Left base **stationary** for the duration of testing
- Observed LEDs:
  - PWR LED solid
  - PVT LED blinking (GNSS navigation active)
  - GPS ‚Üí XBee LED blinking (data flowing to radio)

**Conclusion:**  
Base hardware, power, and GNSS reception were all healthy.

---

## Rover Setup
- Powered the **rover** via GPS-side USB
- Connected to u-center through the ZED-F9P USB (not XBee USB)
- Verified rover antenna orientation and open sky exposure
- Confirmed rover initially reported:
  - `3D / DGNSS / FLOAT`

**Conclusion:**  
Rover was receiving differential corrections and participating in RTK.

---

## RTCM Verification
- Opened `UBX ‚Üí RXM ‚Üí RTCM` in u-center
- Observed RTCM messages incrementing
- In `UBX ‚Üí NAV ‚Üí PVT`, observed:
  - `Fix Flags: FixOK DGNSS`
  - `Age of most recently received differential corrections: 1‚Äì2 s`

**Conclusion:**  
RTCM corrections were being successfully transmitted from base to rover via XBee.

---

## Achieving RTK FIX
- Initially remained in `FLOAT` due to partial tree cover
- Moved **only the rover** to clearer sky while leaving base fixed
- After remaining stationary:
  - Fix mode transitioned to `3D / DGNSS / FIXED`
  - 2D accuracy ‚âà **1 cm**
  - 3D accuracy ‚âà **2‚Äì3 cm**

**Conclusion:**  
The full RTK pipeline (base ‚Üí radio ‚Üí rover ‚Üí ambiguity resolution) works.

---

## Environmental & Behavioral Testing
- Moved rover under tree canopy and a ceiling
- Observed:
  - FIX ‚Üí FLOAT transitions
  - Accuracy fields remained low for a short time (filter inertia)
- Learned:
  - Accuracy values can look ‚Äúgood‚Äù even when FIX is lost
  - FIX state is about **carrier phase confidence**, not raw accuracy
- After environmental degradation:
  - FIX recovery took ~30 minutes of uninterrupted clean sky

**Conclusion:**  
RTK FIX recovery time is environment-dependent and non-deterministic.

---

## u-center Message Inspection (ESP32-Relevant)
- `NAV-HPPOSLLH` **not populated** (not enabled by default)
- `NAV-PVT` **fully populated and active**
  - Provides:
    - Latitude / Longitude
    - Fix type
    - Carrier range status
    - DGNSS state
    - Satellite count
    - PDOP

**Conclusion:**  
ESP32 integration can start using **UBX NAV-PVT** without changing configuration.

---

## Key Technical Takeaways
- RTK FIX is not guaranteed at all times
- FLOAT/DGNSS can appear very accurate but is not integer-resolved
- FIX must be explicitly gated at log time
- Base placement and sky view dominate system behavior
- HPPOSLLH is optional and can be enabled later

---

## Implications for Final Design
For ‚Äúlog a watermelon cut‚Äù functionality:
- On button press:
  - Only log if fix state is **FIXED**
  - Otherwise wait or reject
- Always log fix type alongside coordinates
- ESP32 will parse:
  - `UBX NAV-PVT`
  - Not NMEA
- Averaging multiple samples after FIX is recommended

---

## Current Status
- ‚úÖ Base working
- ‚úÖ Rover working
- ‚úÖ RTCM corrections verified
- ‚úÖ RTK FIX achieved
- ‚úÖ FIX/FLOAT behavior understood
- üîú ESP32 UART parsing and button-press logic

---

## Open Next Steps
- Define ESP32 UART wiring and voltage levels
- Implement UBX NAV-PVT parser on ESP32
- Add button-press state machine:
  - Wait for FIX
  - Sample N points
  - Average and store
- Optional: enable NAV-HPPOSLLH for higher-precision logging
